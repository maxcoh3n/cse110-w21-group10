<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>timer.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addTaskEvent">addTaskEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#AddToLog">AddToLog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#changeSession">changeSession</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ChangeToEnglish">ChangeToEnglish</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ChangeToSpanish">ChangeToSpanish</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#clearDataPrompt">clearDataPrompt</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#clearTaskList">clearTaskList</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#comple">comple</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#completedEvent">completedEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#decNumCompletedTasks">decNumCompletedTasks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#del">del</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#drawHorseShoe">drawHorseShoe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#endBreak">endBreak</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getDate">getDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#handleNumDaysWorking">handleNumDaysWorking</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#incNumCompletedTasks">incNumCompletedTasks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#incNumSessions">incNumSessions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#inCompleted">inCompleted</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isCompleted">isCompleted</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#keyUpEvent">keyUpEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderAll">renderAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderCircles">renderCircles</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderOne">renderOne</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderStatistics">renderStatistics</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#RenderToLog">RenderToLog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#resetColors">resetColors</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#resetSettings">resetSettings</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setLocalStorageDefaults">setLocalStorageDefaults</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#start">start</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#startLongBreak">startLongBreak</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#stopHorseShoe">stopHorseShoe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#timer">timer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#toggleNumSessionInput">toggleNumSessionInput</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#undo">undo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateCountdown">updateCountdown</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateCurrColor">updateCurrColor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateLogWhenPageRefresh">updateLogWhenPageRefresh</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateLongBreaktime">updateLongBreaktime</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateNumSessions">updateNumSessions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updatePomoLog">updatePomoLog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updatePrevColor">updatePrevColor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateShortBreaktime">updateShortBreaktime</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateSound">updateSound</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateTest">updateTest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateVol">updateVol</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateVolIcon">updateVolIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateWorktime">updateWorktime</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">timer.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//Timer
import { updatePomoLog, AddToLog } from "./pomoLog.js";
import { changeSession, endBreak, startLongBreak, resetColors } from "./sessionCircles.js";
import { renderStatistics } from "./statistics.js";
import { getDate } from "./getDate.js";
import { drawHorseShoe, stopHorseShoe } from "./horseshoe.js";

// Adds an event listener to the start button when page is loaded.
window.addEventListener("DOMContentLoaded", (event) => {
  const countdown = document.getElementById("countdown");
  countdown.innerHTML = `${localStorage.getItem("workMins")}:00`;

  const startBtn = document.getElementById("start-btn");
  startBtn.addEventListener("click", start);
});

/**
 * Starts the timer, duration depend on user input for work time
 * and styling features depend on break or work time
 */
function start() {
  timer();
}

let sessionNum = localStorage.getItem("numCurrentSech");

/**
 * Uses the countdown h1 to set and run a
 * timer of length designated by the startTime parameter.
 * If the button with "start" is clicked
 *  disable completed button
 *  Change the button to "Cancel"
 * If the button with "cancel" is clicked
 *  Enable choosing task
 *  Stop countdown
 *  Change the button to "Start".
 */
function timer() {
  const sound = document.getElementById("alarm-sound");
  let taskList = document.getElementById("task-list");

  const completed = document.getElementById("complete-task-btn");
  completed.innerHTML = "Completed";
  let removeLabels = [];
  let removeTasks = [];

  const startBtn = document.getElementById("start-btn");
  if (startBtn.innerHTML == "Start") {
    const vol = localStorage.getItem("vol");
    sound.volume = vol / 100;
    completed.disabled = true;
    let taskList = document.getElementById("task-list");
    for (let task of taskList.childNodes) {
      task.disabled = true;
      let label = document.getElementById("label" + task.id);
      if (label != null &amp;&amp; label.style.textDecoration == "line-through") {
        removeLabels.push(label);
        removeTasks.push(task);
      }
    }
    for (let label of removeLabels) {
      label.remove();
    }
    for (let task of removeTasks) {
      task.remove();
    }

    startBtn.innerHTML = "Cancel";

    // Disable all other features
    document.getElementById("settings-btn").disabled = true;
    document.getElementById("settings-btn").style.opacity = "60%";
    document.getElementById("task-list-container").style.opacity = "60%";
    document.getElementById("new-task").disabled = true;
    document.getElementById("new-task-btn").disabled = true;
    document.getElementById("info-btn").disabled = true;
    let pomologBtn = document.getElementById("pomo-toggle");
    pomologBtn.disabled = true;
    document.getElementById("pomo-label").style.opacity = "60%";
    let pomologOpen = pomologBtn.checked;
    pomologBtn.checked = false;
    localStorage.setItem("pomologOpen", String(pomologOpen));
    let maxSessions = localStorage.getItem("numSessions");
    if (sessionNum >= maxSessions) {
      sessionNum = 0;
    }
    endBreak(sessionNum);

    updateCountdown(true);
  } else {
    stopHorseShoe();

    // Enable all other features
    document.getElementById("settings-btn").disabled = false;
    document.getElementById("settings-btn").style.opacity = "100%";
    document.getElementById("task-list-container").style.opacity = "100%";
    document.getElementById("new-task-container").style.opacity = "100%";
    document.getElementById("new-task").disabled = false;
    document.getElementById("new-task-btn").disabled = false;
    document.getElementById("info-btn").disabled = false;
    let pomologBtn = document.getElementById("pomo-toggle");
    pomologBtn.disabled = false;
    document.getElementById("pomo-label").style.opacity = "100%";
    pomologBtn.checked = localStorage.getItem("pomologOpen") == "true" ? true : false;

    resetColors();

    let completedSessions = localStorage.getItem("completedSessions");
    completedSessions = JSON.parse(completedSessions);
    let currentTaskName = document.getElementById("curr-task").children[0].innerHTML;
    let newTask = true;
    for (let i = 0; i &lt; completedSessions.length; i++) {
      if (completedSessions[i].taskName == currentTaskName) {
        newTask = false;
        break;
      }
    }
    if (newTask == true) {
      completed.innerHTML = "Delete";
    } else {
      completed.innerHTML = "Completed";
    }

    let taskList = document.getElementById("task-list");
    for (let task of taskList.childNodes) {
      task.disabled = false; // enables changing tasks
    }
    completed.disabled = false;
    sound.pause();
    sound.currentTime = 0;
    updateCountdown(false);
    startBtn.innerHTML = "Start";
  }
}

/**
 * @param {boolean} IsOn
 * If the condition input is true
 *  Set time equal to work or short break or long break
 *  Start counting down the timer
 * If the condition input is false
 *  Display the time of work or short break or long break
 *  without counting down
 *  disable the complete button
 */
function updateCountdown(IsOn) {
  const title = document.getElementById("title-countdown");

  const devMode = document.getElementById("dev-mode");
  if (IsOn) {
    var time; // must be var so that updateTime can access it
    if (localStorage.getItem("workOrBreak") == "work") {
      time = localStorage.getItem("workMins") * 60;
      drawHorseShoe(time / 60, 1, devMode.checked ? true : false);
    } else if (localStorage.getItem("workOrBreak") == "break") {
      time = localStorage.getItem("shortBreakMins") * 60;
      drawHorseShoe(time / 60, -1, devMode.checked ? true : false);
    } else if (localStorage.getItem("workOrBreak") == "longBreak") {
      time = localStorage.getItem("longBreakMins") * 60;
      drawHorseShoe(time / 60, -1, devMode.checked ? true : false);
    }
    var count = setInterval(updateTime, devMode.checked ? 0.5 : 1000);
    localStorage.setItem("intervalID", count);
  } else {
    let taskList = document.getElementById("task-list");
    for (let task of taskList.childNodes) {
      task.disabled = false; // enables changing tasks
    }
    document.getElementById("settings-btn").style.display = "block";
    clearInterval(localStorage.getItem("intervalID"));
    if (localStorage.getItem("workOrBreak") == "work") {
      countdown.innerHTML = `${localStorage.getItem("workMins")}:00`;
      title.innerHTML = `${localStorage.getItem("workMins")}:00`;
    } else if (localStorage.getItem("workOrBreak") != "work") {
      localStorage.setItem("workOrBreak", "work");
      countdown.innerHTML = `${localStorage.getItem("workMins")}:00`;
      title.innerHTML = `${localStorage.getItem("workMins")}:00`;
    }

    const completed = document.getElementById("complete-task-btn");
    completed.disabled = false;
  }

  /**
   * Display the if the user is currently in work time or break time
   * Count down the timer
   * When the time reach 0
   * Notify use with alarm sound
   * Add new completed session with the current task
   * Add the complete task to log
   */
  function updateTime() {
    const startBtn = document.getElementById("start-btn");

    time--;
    time = time &lt; 0 ? 0 : time;

    let mins = Math.floor(time / 60);
    let sec = time % 60;

    sec = sec &lt; 10 ? "0" + sec : sec;

    title.innerHTML = `${mins}:${sec}`;
    countdown.innerHTML = `${mins}:${sec}`;
    if (time == 0) {
      stopHorseShoe();
      const sound = document.getElementById("alarm-sound");
      sound.src = localStorage.getItem("soundType");
      sound.play();
      clearInterval(count);
      if (localStorage.getItem("workOrBreak") == "work") {
        incNumSessions();
        handleNumDaysWorking();

        //Complete tasks
        let completedSessions = localStorage.getItem("completedSessions");
        completedSessions = JSON.parse(completedSessions);
        let newTask = true;
        let date = getDate();
        let worktimeNumber = document.getElementById("worktime-number");
        let currentTaskName = document.getElementById("curr-task").children[0].innerHTML;

        for (let i = 0; i &lt; completedSessions.length; i++) {
          if (
            completedSessions[i].taskName == currentTaskName &amp;&amp;
            completedSessions[i].date == date &amp;&amp;
            !completedSessions[i].completed
          ) {
            newTask = false;
            completedSessions[i].durationArray.push(worktimeNumber.value);
            updatePomoLog(completedSessions[i]); //for pomo log, function from pomoLog.js
          }
        }

        if (newTask == true) {
          let completedTask = {
            taskName: currentTaskName,
            durationArray: [worktimeNumber.value],
            date: date,
            completed: false,
          };
          AddToLog(completedTask);
          completedSessions.push(completedTask);
        }

        localStorage.setItem("completedSessions", JSON.stringify(completedSessions));
        localStorage.setItem("numCurrentSech", 1 + Number(localStorage.getItem("numCurrentSech")));

        sessionNum = Number(sessionNum) + 1;
        changeSession(sessionNum);

        if (localStorage.getItem("numCurrentSech") >= localStorage.getItem("numSessions")) {
          localStorage.setItem("workOrBreak", "longBreak");
          localStorage.setItem("numCurrentSech", "0");
        } else {
          localStorage.setItem("workOrBreak", "break");
        }

        // Enable all other features
        document.getElementById("settings-btn").disabled = false;
        document.getElementById("settings-btn").style.opacity = "100%";
        document.getElementById("task-list-container").style.opacity = "100%";
        document.getElementById("new-task-container").style.opacity = "100%";
        document.getElementById("new-task").disabled = false;
        document.getElementById("new-task-btn").disabled = false;
        document.getElementById("info-btn").disabled = false;
        let pomologBtn = document.getElementById("pomo-toggle");
        pomologBtn.disabled = false;
        document.getElementById("pomo-label").style.opacity = "100%";
        pomologBtn.checked = localStorage.getItem("pomologOpen") == "true" ? true : false;
      } else if (localStorage.getItem("workOrBreak") == "break") {
        localStorage.setItem("workOrBreak", "work");
        startBtn.innerHTML = "Start";
        updateCountdown(false);
        return;
      } else if (localStorage.getItem("workOrBreak") == "longBreak") {
        localStorage.setItem("workOrBreak", "work");
        sessionNum = 0;
        startLongBreak(sessionNum);
        startBtn.innerHTML = "Start";
        updateCountdown(false);
        return;
      }
      updateCountdown(true);
    }
  }
}

/**
 * increases numsessions statistic
 */
function incNumSessions() {
  let stats = JSON.parse(localStorage.getItem("statistics"));
  stats.numSessions++;
  localStorage.setItem("statistics", JSON.stringify(stats));
  renderStatistics();
}

/**
 * increases numsessions statistic
 */
function handleNumDaysWorking() {
  let lastDayWorked = localStorage.getItem("lastDayWorked");
  let date = getDate();
  if (lastDayWorked != date) {
    localStorage.setItem("lastDayWorked", date);
    let stats = JSON.parse(localStorage.getItem("statistics"));
    stats.numDaysWorking++;
    localStorage.setItem("statistics", JSON.stringify(stats));
    renderStatistics();
  }
}

/**
 * space bar to start timer
 */
document.body.onkeyup = function (e) {
  if (e.keyCode == 32 &amp;&amp; document.activeElement != document.getElementById("new-task")) {
    e.preventDefault();
    const startBtn = document.getElementById("start-btn");
    startBtn.click();
  }
};

export { timer };
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Wed Mar 17 2021 01:06:52 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
