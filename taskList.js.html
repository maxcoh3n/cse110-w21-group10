<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>taskList.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addTaskEvent">addTaskEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#AddToLog">AddToLog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#changeSession">changeSession</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ChangeToEnglish">ChangeToEnglish</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ChangeToSpanish">ChangeToSpanish</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#clearDataPrompt">clearDataPrompt</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#clearTaskList">clearTaskList</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#comple">comple</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#completedEvent">completedEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#decNumCompletedTasks">decNumCompletedTasks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#del">del</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#drawHorseShoe">drawHorseShoe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#endBreak">endBreak</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getDate">getDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#handleNumDaysWorking">handleNumDaysWorking</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#incNumCompletedTasks">incNumCompletedTasks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#incNumSessions">incNumSessions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#inCompleted">inCompleted</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isCompleted">isCompleted</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#keyUpEvent">keyUpEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderAll">renderAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderCircles">renderCircles</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderOne">renderOne</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderStatistics">renderStatistics</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#RenderToLog">RenderToLog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#resetColors">resetColors</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#resetSettings">resetSettings</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setLocalStorageDefaults">setLocalStorageDefaults</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#start">start</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#startLongBreak">startLongBreak</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#stopHorseShoe">stopHorseShoe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#timer">timer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#toggleNumSessionInput">toggleNumSessionInput</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#undo">undo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateCountdown">updateCountdown</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateCurrColor">updateCurrColor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateLogWhenPageRefresh">updateLogWhenPageRefresh</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateLongBreaktime">updateLongBreaktime</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateNumSessions">updateNumSessions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updatePomoLog">updatePomoLog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updatePrevColor">updatePrevColor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateShortBreaktime">updateShortBreaktime</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateSound">updateSound</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateTest">updateTest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateVol">updateVol</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateVolIcon">updateVolIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateWorktime">updateWorktime</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">taskList.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { getDate } from "./getDate.js";
import { renderStatistics } from "./statistics.js";
import { updateLogWhenPageRefresh } from "./pomoLog.js";

// adds listeners and refreshes when page is loaded
window.addEventListener("DOMContentLoaded", (event) => {
  renderAll();

  const addTask = document.getElementById("new-task-btn");
  addTask.addEventListener("click", addTaskEvent);

  const newTaskInput = document.getElementById("new-task");
  newTaskInput.addEventListener("keyup", keyUpEvent);

  const completed = document.getElementById("complete-task-btn");
  completed.addEventListener("click", completedEvent);
});

/**
 * @param {Object} taskInput 
 * Takes the taskInput (task name) and renders that task to the task list
 */
function renderOne(taskInput) {
  const taskButton = document.getElementById("complete-task-btn");

  let taskList = document.getElementById("task-list");
  let tasksArray = localStorage.getItem("upcomingTasks");
  tasksArray = JSON.parse(tasksArray);

  let task = document.createElement("input");
  task.addEventListener("click", function () {
    let taskList = document.getElementById("task-list");

    let boxChecked = false;
    for (let box of taskList.childNodes) {
      if (box.checked) {
        boxChecked = true;
        let completedSessions = localStorage.getItem("completedSessions");
        completedSessions = JSON.parse(completedSessions);
        let foundTask = false;
        for (let i = 0; i &lt; completedSessions.length; i++) {
          if (box.id == completedSessions[i].taskName &amp;&amp; completedSessions[i].date == getDate() ) {
            foundTask = true;
            if (completedSessions[i].completed == false) {
              document.getElementById("curr-task").children[0].innerHTML = box.id;
              taskButton.innerHTML = "Completed";
            } else {
              taskButton.innerHTML = "Undo";
              document.getElementById("curr-task").children[0].innerHTML = "Default Task";
            }
          }
        }
        if (foundTask == false) {
          document.getElementById("curr-task").children[0].innerHTML = box.id;
          taskButton.innerHTML = "Delete";
        }
      }
    }
    if (boxChecked == false) {
      document.getElementById("curr-task").children[0].innerHTML = "Default Task";
    }
  });

  task.setAttribute("type", "radio");
  task.setAttribute("name", "task-list");
  task.setAttribute("id", taskInput);
  if (tasksArray.length == 1) {
    task.setAttribute("checked", "true");
    document.getElementById("curr-task").children[0].innerHTML = taskInput;
  }
  taskList.appendChild(task);

  let label = document.createElement("label");
  label.setAttribute("for", taskInput);
  label.setAttribute("class", "tasks");
  label.setAttribute("id", "label" + taskInput);

  label.innerHTML = taskInput + "&lt;br>";
  taskList.appendChild(label);
}

/**
 * runs on page load
 * renders all tasks in the upcomingTasks local storage to the task list
 */
function renderAll() {
  const taskButton = document.getElementById("complete-task-btn");
  let tasksArray = localStorage.getItem("upcomingTasks");
  tasksArray = JSON.parse(tasksArray);

  if (tasksArray.length == 0) {
    taskButton.disabled = true;
  } else {
    taskButton.disabled = false;
  }

  for (let i = 0; i &lt; tasksArray.length; i++) {
    renderOne(tasksArray[i]);
  }

  if (tasksArray.length != 0) {
    let completedSessions = localStorage.getItem("completedSessions");
    completedSessions = JSON.parse(completedSessions);
    let foundTask = false;
    for (let i = 0; i &lt; completedSessions.length; i++) {
      if (tasksArray[0] == completedSessions[i].taskName &amp;&amp; completedSessions[i].date == getDate() ) {
        foundTask = true;
        if (completedSessions[i].completed == false) {
          taskButton.innerHTML = "Completed";
        } else {
          taskButton.innerHTML = "Undo";
        }
      }
    }
    if (foundTask == false) {
      taskButton.innerHTML = "Delete";
    }

    document.getElementById(tasksArray[0]).checked = true;
    document.getElementById("curr-task").children[0].innerHTML = tasksArray[0];
  }
}

/**
* adds a new task to the upcoming tasks list
*/
  function addTaskEvent() {
  const taskButton = document.getElementById("complete-task-btn");
  let tasksArray = localStorage.getItem("upcomingTasks");
  tasksArray = JSON.parse(tasksArray);

  const newTaskInput = document.getElementById("new-task");

  if (tasksArray.includes(newTaskInput.value)) {
    newTaskInput.value = "";
  }

  let taskList = document.getElementById('task-list');
  for (let box of taskList.childNodes) {
    if (box.id == newTaskInput.value) {
      newTaskInput.value = "";
      }
  }

  let completedSessions = localStorage.getItem("completedSessions");
  completedSessions = JSON.parse(completedSessions);

  // if this was already completed today, we uncomplete it
  for( let task of completedSessions ) {
    if( task.taskName == newTaskInput.value &amp;&amp; task.date == getDate() ) {
      task.completed = false;
      decNumCompletedTasks();
      decNumCompletedTaskSessions(task.durationArray.length);
    }
  }

  localStorage.setItem("completedSessions", JSON.stringify(completedSessions));

  if (newTaskInput.value) {
    tasksArray.push(newTaskInput.value);
    taskButton.disabled = false;
    localStorage.setItem("upcomingTasks", JSON.stringify(tasksArray));
    renderOne(newTaskInput.value);
    if(tasksArray.length == 1 ) {
      if (inCompleted(newTaskInput.value) == false ) {
        taskButton.innerHTML = "Delete";
      } else {
        taskButton.innerHTML = "Completed";
      }
    }
    newTaskInput.value = "";
  }

  updateLogWhenPageRefresh();
}

/**
* clears the display of the task list to the user
*/
function clearTaskList() {

  let taskList = document.getElementById('task-list');
  while( taskList.firstChild ) {
    taskList.removeChild(taskList.firstChild);
  }

}



/**
* allows for enter key to add a new task to the task list
*/
function keyUpEvent(event) {
  if (event.keyCode === 13) {
    event.preventDefault();
    const addTask = document.getElementById("new-task-btn");
    addTask.click();
  }
}

/**
 * @param {string} taskInput - a task inputted by the user
 * Checking if the task is in completed session and date is today
 * If the task is found
 *  return true
 * else
 *  return false
 * determine if the button will say delete
 */
function inCompleted(taskName) {
  let completedSessions = localStorage.getItem("completedSessions");
  completedSessions = JSON.parse(completedSessions);
  for (let task of completedSessions) {
    if (task.taskName == taskName &amp;&amp; task.date == getDate()) {
      return true;
    }
  }
  return false;
}

/**
 * @param {string} taskName - a task inputted by the user
 * Checking if the task is in progress of complete
 * If the task is found
 *  return true
 * else
 *  return false
 * determines if the button says undo or complete
 */
function isCompleted(taskName) {
  let completedSessions = localStorage.getItem("completedSessions");
  completedSessions = JSON.parse(completedSessions);
  for (let task of completedSessions) {
    if (task.taskName == taskName) {
      return task.completed;
    }
  }
  return false;
}

//must be here to be accessed by comple and undo functions
let completedTaskSessions = 0;

/**
 * Marked a task as completed
 * Strike through the task after task completed
 * Change the check to the next task
 */
function comple() {
  incNumCompletedTasks();

  let taskList = document.getElementById("task-list");
  let completedSessions = localStorage.getItem("completedSessions");
  completedSessions = JSON.parse(completedSessions);
  let taskArray = [];

  const completed = document.getElementById("complete-task-btn");
  for (let box of taskList.childNodes) {
    if (box.checked) {
      for(let i = 0; i&lt;completedSessions.length; i++){
        if( box.id == completedSessions[i].taskName &amp;&amp; completedSessions[i].date == getDate()) {
          completedSessions[i].completed = true;
          completed.innerHTML = "Undo";
          document.getElementById("curr-task").children[0].innerHTML = "Default Task";
          completedTaskSessions = completedSessions[i].durationArray.length;
        }
      }
      localStorage.setItem("completedSessions", JSON.stringify(completedSessions));

      let label = document.getElementById("label" + box.id);
      label.style.textDecoration = "line-through";
    } else {
      if (box.name == "task-list" &amp;&amp; document.getElementById("label" + box.id).style.textDecoration != "line-through") {
        taskArray.push(box.id);
      }
    }
  }
  incNumCompletedTaskSessions(completedTaskSessions);
  localStorage.setItem("upcomingTasks", JSON.stringify(taskArray));

  if (taskArray.length > 0) {
    document.getElementById(taskArray[0]).checked = true;
    document.getElementById("curr-task").children[0].innerHTML = taskArray[0];
    if (inCompleted(taskArray[0])) {
      if (isCompleted(taskArray[0])) {
        completed.innerHTML = "Undo";
      } else {
        completed.innerHTML = "Completed";
      }
    } else {
      completed.innerHTML = "Delete";
    }
  }
  updateLogWhenPageRefresh();
}

/**
 * Undo a task that marked completed
 */
 function undo() {
  decNumCompletedTasks();
  decNumCompletedTaskSessions(completedTaskSessions);
  completedTaskSessions = 0;

  let taskList = document.getElementById("task-list");
  let taskArray = [];
  for (let box of taskList.childNodes) {
    let label = document.getElementById("label" + box.id);
    if (box.checked) {
      document.getElementById("curr-task").children[0].innerHTML = box.id;
      const completed = document.getElementById("complete-task-btn");
      completed.innerHTML = "Completed";
      label.style.textDecoration = "none";
      let completedSessions = localStorage.getItem("completedSessions");
      completedSessions = JSON.parse(completedSessions);
      for (let i = 0; i &lt; completedSessions.length; i++) {
        if( box.id == completedSessions[i].taskName &amp;&amp; completedSessions[i].date == getDate()) {
          completedSessions[i].completed = false;
        }
      }
      localStorage.setItem("completedSessions", JSON.stringify(completedSessions));
    }
    if (box.name == "task-list") {
      taskArray.push(box.id);
    }
  }
  localStorage.setItem("upcomingTasks", JSON.stringify(taskArray));
  updateLogWhenPageRefresh();
}


/**
* handles the delete state for tasks
*/
function del() {

  let taskList = document.getElementById("task-list");
  document.getElementById("curr-task").children[0].innerHTML = "Default Task";
  let taskArray = [];
  let upcomingTasks = localStorage.getItem("upcomingTasks");
  upcomingTasks = JSON.parse(upcomingTasks);
  let nextTaskNum = 0;
  for (let box of taskList.childNodes) {
    let label = document.getElementById("label" + box.id);
    if (box.checked == true) {
      taskArray = upcomingTasks.filter((task) => task != box.id);
      label.remove();
      box.remove();
      break;
    }
    nextTaskNum++;
  }
  nextTaskNum = Math.floor(nextTaskNum / 2);
  localStorage.setItem("upcomingTasks", JSON.stringify(taskArray));

  const completed = document.getElementById("complete-task-btn");
  if (taskArray.length > 0) {
    if (nextTaskNum &lt; taskArray.length) {
      document.getElementById(taskArray[nextTaskNum]).checked = true;
      document.getElementById("curr-task").children[0].innerHTML = taskArray[nextTaskNum];
      if (inCompleted(taskArray[nextTaskNum])) {
        if (isCompleted(taskArray[nextTaskNum])) {
          completed.innerHTML = "Undo";
        } else {
          completed.innerHTML = "Completed";
        }
      } else {
        completed.innerHTML = "Delete";
      }
    } else {
      document.getElementById(taskArray[0]).checked = true;
      document.getElementById("curr-task").children[0].innerHTML = taskArray[0];
      if (inCompleted(taskArray[0])) {
        if (isCompleted(taskArray[0])) {
          completed.innerHTML = "Undo";
        } else {
          completed.innerHTML = "Completed";
        }
      } else {
        completed.innerHTML = "Delete";
      }
    }
  }

  if(taskList.children.length != 0){
    completed.disabled = false;
  } else {
    completed.disabled = true;
  }
}

/**
 * increases numCompletedTasks statistic
 */
function incNumCompletedTasks() {
  let stats = JSON.parse(localStorage.getItem("statistics"));
  stats.numCompletedTasks++;
  localStorage.setItem("statistics", JSON.stringify(stats));
  renderStatistics();
}

/**
 * decreases numCompletedTasks statistic
 */
function decNumCompletedTasks() {
  let stats = JSON.parse(localStorage.getItem("statistics"));
  stats.numCompletedTasks--;
  localStorage.setItem("statistics", JSON.stringify(stats));
  renderStatistics();
}

/*
 * increases numCompletedTaskSessions statistic
 * @param {number} numSessions
 */
function incNumCompletedTaskSessions(numSessions) {
  let stats = JSON.parse(localStorage.getItem("statistics"));
  stats.numCompletedTaskSessions += numSessions;
  localStorage.setItem("statistics", JSON.stringify(stats));
  renderStatistics();
}

/*
 * decreases numCompletedTaskSessions statistic
 * @param {number} numSessions
 */
function decNumCompletedTaskSessions(numSessions) {
  let stats = JSON.parse(localStorage.getItem("statistics"));
  stats.numCompletedTaskSessions -= numSessions;
  localStorage.setItem("statistics", JSON.stringify(stats));
  renderStatistics();
}

/**
* handles the three phases for tasks
*/
function completedEvent(){
  const completed = document.getElementById("complete-task-btn");
  if (completed.innerHTML == "Completed") {
    comple();
  } else if (completed.innerHTML == "Undo") {
    undo();
  } else if (completed.innerHTML == "Delete") {
    del();
  }
}

export {renderOne, renderAll, addTaskEvent, keyUpEvent , 
  inCompleted, isCompleted, comple, undo, del, incNumCompletedTasks, clearTaskList,
  decNumCompletedTasks, incNumCompletedTaskSessions, 
  decNumCompletedTaskSessions, completedEvent};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Wed Mar 17 2021 00:51:55 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
